/* Copyright (c) 2011  All Rights Reserved - Kevin Roast http://www.kevs3d.co.uk/ */
var KEY={SHIFT:16,CTRL:17,ESC:27,RIGHT:39,UP:38,LEFT:37,DOWN:40,SPACE:32,A:65,E:69,G:71,L:76,P:80,R:82,Z:90};var GameHandler={game:null,paused:false,canvas:null,width:0,height:0,frameCount:0,maxfps:0,init:function(){this.canvas=document.getElementById("canvas");this.width=this.canvas.height;this.height=this.canvas.width},start:function(a){if(a){this.game=a}GameHandler.game.tick()},pause:function(){if(this.paused){this.paused=false;GameHandler.game.tick()}else{this.paused=true}}};if(typeof Game=="undefined"||!Game){var Game={}}(function(){Game.Main=function(){var d=this;document.onkeydown=function(e){var f=(e===null?window.event.keyCode:e.keyCode);if(d.sceneIndex!==-1){if(d.scenes[d.sceneIndex].onKeyDownHandler(f)){if(e){e.preventDefault();e.stopPropagation()}}}};document.onkeyup=function(e){var f=(e===null?window.event.keyCode:e.keyCode);if(d.sceneIndex!==-1){if(d.scenes[d.sceneIndex].onKeyUpHandler(f)){if(e){e.preventDefault();e.stopPropagation()}}}}};Game.Main.prototype={scenes:[],startScene:null,endScene:null,currentScene:null,sceneIndex:-1,fps:33,lastFrameStart:0,interval:null,benchmarkFrameCount:0,tick:function a(){var g=new Date().getTime();var f=this.currentScene;if(f===null){this.sceneIndex=0;f=this.scenes[0];f.onInitScene()}if((f.interval===null||f.interval.complete)&&f.isComplete()){if(this.sceneIndex===0){this.benchmarkFrameCount=0}this.sceneIndex++;if(this.sceneIndex<this.scenes.length){f=this.scenes[this.sceneIndex]}else{this.sceneIndex=0;f=this.scenes[0]}f.onInitScene()}WebGL2D.enable(GameHandler.canvas);var e=GameHandler.canvas.getContext("webgl-2d");if(f.interval===null||f.interval.complete){f.onBeforeRenderScene();this.onRenderGame(e);f.onRenderScene(e);if(this.sceneIndex!==0){this.benchmarkFrameCount++}}else{this.onRenderGame(e);f.interval.intervalRenderer.call(f,f.interval,e)}this.currentScene=f;GameHandler.frameCount++;var d=Math.floor(1000/this.fps)-(new Date().getTime()-g);GameHandler.maxfps=Math.round(1000/(g-this.lastFrameStart));this.lastFrameStart=g;if(!GameHandler.paused){setTimeout(GameHandler.start,d<=0?1:d)}},onRenderGame:function b(d){},isGameOver:function c(){return false}}})();(function(){Game.Scene=function(j,i){this.playable=j;this.interval=i};Game.Scene.prototype={playable:true,interval:null,isPlayable:function d(){return this.playable},onInitScene:function c(){if(this.interval!==null){this.interval.reset()}},onBeforeRenderScene:function e(){},onRenderScene:function a(i){},onRenderInterval:function f(i){},onKeyDownHandler:function g(i){},onKeyUpHandler:function b(i){},isComplete:function h(){return false}}})();(function(){Game.Interval=function(b,c){this.label=b;this.intervalRenderer=c;this.framecounter=0;this.complete=false};Game.Interval.prototype={label:null,intervalRenderer:null,framecounter:0,complete:false,reset:function a(){this.framecounter=0;this.complete=false}}})();(function(){Game.Actor=function(e,d){this.position=e;this.vector=d;return this};Game.Actor.prototype={position:null,vector:null,onUpdate:function a(){},onRender:function c(d){},expired:function b(){return false}}})();(function(){Game.SpriteActor=function(d,b,c){Game.SpriteActor.superclass.constructor.call(this,d,b);if(c){this.frameSize=c}return this};extend(Game.SpriteActor,Game.Actor,{frameSize:64,animImage:null,animLength:0,animForward:true,animSpeed:1,animFrame:0,renderSprite:function a(e,c,h,d,g){var f=this.animFrame<<6,b=this.frameSize;e.drawImage(this.animImage,0,f,b,b,c,h,d,d);if(g){if(c<0||h<0){e.drawImage(this.animImage,0,f,b,b,(c<0?(GameHandler.width+c):c),(h<0?(GameHandler.height+h):h),d,d)}if(c+d>=GameHandler.width||h+d>=GameHandler.height){e.drawImage(this.animImage,0,f,b,b,(c+d>=GameHandler.width?(c-GameHandler.width):c),(h+d>=GameHandler.height?(h-GameHandler.height):h),d,d)}}if(this.animForward){this.animFrame+=this.animSpeed;if(this.animFrame>=this.animLength){this.animFrame=0}}else{this.animFrame-=this.animSpeed;if(this.animFrame<0){this.animFrame=this.animLength-1}}}})})();(function(){Game.EnemyActor=function(d,c){this.position=d;this.vector=c;return this};extend(Game.EnemyActor,Game.SpriteActor,{alive:true,expired:function a(){return !(this.alive)},hit:function b(c){this.alive=false;return true}})})();(function(){Game.EffectActor=function(d,b,c){Game.EffectActor.superclass.constructor.call(this,d,b);this.lifespan=c;return this};extend(Game.EffectActor,Game.Actor,{lifespan:0,expired:function a(){return(--this.lifespan===0)}})})();(function(){Game.Preloader=function(){this.images=new Array();return this};Game.Preloader.prototype={images:null,callback:null,counter:0,addImage:function b(c,d){var e=this;c.url=d;c.onload=function(){e.counter++;if(e.counter===e.images.length){e.callback.call(e)}};this.images.push(c)},onLoadCallback:function a(e){this.counter=0;this.callback=e;for(var d=0,c=this.images.length;d<c;d++){this.images[d].src=this.images[d].url}}}})();Game.drawText=function(e,b,c,a,f,d){e.save();if(d){e.strokeStyle=d}e.font=c;e.strokeText(b,a,f);e.restore()};Game.fillText=function(e,b,c,a,f,d){e.save();if(d){e.fillStyle=d}e.font=c;e.fillText(b,a,f);e.restore()};Game.centerFillText=function(d,a,b,e,c){d.save();if(c){d.fillStyle=c}d.font=b;d.fillText(a,(GameHandler.width-d.measureText(a).width)/2,e);d.restore()};Game.hasAudio=function(){var b=false;try{var a=new Audio("");b=!!(a.canPlayType&&a.play)}catch(c){b=false}return b};
